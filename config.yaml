# ä»£ç†æœåŠ¡æä¾›å•†
proxy-providers:
  NB:
    url: "__NB_SUB_URL__"
    type: http
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
    exclude-filter: "(?i)å‰©ä½™|æµé‡|å¥—é¤|å®˜ç½‘|ç¾¤ç»„|åˆ°æœŸ|è¿‡æœŸ|æ—¶é—´|è¿‡æ»¤|å®¢æˆ·ç«¯|å»ºè®®|ipv6"
  Hneko:
    url: "__HNEKO_SUB_URL__"
    type: http
    interval: 86400
    health-check:
      enable: true
      url: "https://www.gstatic.com/generate_204"
      interval: 300
    exclude-filter: "(?i)å‰©ä½™|æµé‡|å¥—é¤|å®˜ç½‘|ç¾¤ç»„|åˆ°æœŸ|è¿‡æœŸ|æ—¶é—´|è¿‡æ»¤|å®¢æˆ·ç«¯|å»ºè®®|é˜²å¤±è”|ipv6"

# åŸºç¡€ä»£ç† (ç›´è¿æ˜¯å¿…é¡»çš„)
proxies:
  - name: "ğŸ¯ ç›´è¿"
    type: direct
    udp: true

# å…¨å±€é…ç½®
mixed-port: 7893                    # HTTP å’Œ SOCKS5 æ··åˆä»£ç†ç«¯å£
#tproxy-port: 7894                  # é€æ˜ä»£ç† TPROXY ç«¯å£
#redir-port: 7892                   # é€æ˜ä»£ç†ç«¯å£
allow-lan: true                     # å…è®¸å±€åŸŸç½‘è¿æ¥
bind-address: "*"                   # ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£
ipv6: false                         # æ˜¯å¦å¤„ç† IPv6 æµé‡
unified-delay: true                 # åœ¨ UI ä¸­æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹çš„ç»Ÿä¸€å»¶è¿Ÿä¿¡æ¯
tcp-concurrent: true                # å¯ç”¨ TCP å¹¶å‘è¿æ¥ï¼Œå°†ä¼šä½¿ç”¨ dns è§£æå‡ºçš„æ‰€æœ‰ IP åœ°å€è¿›è¡Œè¿æ¥ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæˆåŠŸçš„è¿æ¥
log-level: info                     # æ—¥å¿—çº§åˆ« (silent, error, warning, info, debug)
find-process-mode: 'strict'         # æŸ¥æ‰¾è¿æ¥è¿›ç¨‹ (strict æˆ– off)
global-client-fingerprint: chrome   # TLS æŒ‡çº¹ä¼ªè£…
interface-name: ens18               # mihomo çš„æµé‡å‡ºç«™æ¥å£
keep-alive-interval: 15             # TCP Keep Alive åŒ…çš„é—´éš”ï¼Œå•ä½ä¸ºç§’
keep-alive-idle: 15                 # TCP Keep Alive çš„æœ€å¤§ç©ºé—²æ—¶é—´
disable-keep-alive: false           # ç¦ç”¨ TCP Keep Alive

mode: rule                          # è¿è¡Œæ¨¡å¼ (Rule, Global, Direct)

profile:
  store-selected: true              # è®°ä½ä¸Šæ¬¡åœ¨ UI ä¸­é€‰æ‹©çš„ç­–ç•¥ç»„èŠ‚ç‚¹
  store-fake-ip: false              # Fake-IP æ¨¡å¼ä¸‹å»ºè®®å¼€å¯

# æ§åˆ¶é¢æ¿ API
external-controller: 0.0.0.0:9999 # ç›‘å¬åœ°å€å’Œç«¯å£
secret: "__CONTROLLER_SECRET__"   # API å¯†é’¥
external-ui: "/etc/mihomo/ui"     # Web UI é™æ€æ–‡ä»¶è·¯å¾„
external-ui-name: zashboard # æŒ‡å®š UI åç§°
external-ui-url: "https://github.com/Zephyruso/zashboard/archive/refs/heads/gh-pages.zip"

geodata-mode: true
geo-auto-update: true
geo-update-interval: 24
geo-url:
  geoip: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"

# æµé‡å—…æ¢
sniffer:
  enable: true
  sniff:
    HTTP: { ports: [80, 8080-8880], override-destination: true }
    TLS: { ports: [443, 8443] }
    QUIC: { ports: [443, 8443] }
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - "+.baidu.com"
    - "Mijia Cloud"

# TUN è®¾å¤‡
tun:
  enable: true
  stack: system                      # TUN åè®®æ ˆ (gvisor, mixed, system)
  dns-hijack:
    - any:1053                       # åŠ«æŒ DNS ç«¯å£æŸ¥è¯¢
  device: tun0                       # TUN è®¾å¤‡åç§°
  mtu: 9000
  strict-route: true                 # ä¸¥æ ¼è·¯ç”±æ¨¡å¼, å¯æé«˜ DIRECT æµé‡æ•ˆç‡
  auto-route: true                   # è‡ªåŠ¨é…ç½®è·¯ç”±è¡¨ (æ ¸å¿ƒ)
  auto-redirect: true                # è‡ªåŠ¨é‡å®šå‘æµé‡åˆ° TUN (é…åˆ auto-route)
  auto-detect-interface: true        # è‡ªåŠ¨æ£€æµ‹å‡ºç«™ç½‘ç»œæ¥å£

# DNS é…ç½®
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053                # ç›‘å¬æ ‡å‡† DNS ç«¯å£
  enhanced-mode: redir-host           # redir-host æ¨¡å¼
  respect-rules: true
  #enhanced-mode: fake-ip             # fake-ip æ¨¡å¼
  #fake-ip-range: 198.18.0.1/16       # fakeip ä¸‹çš„ IP æ®µè®¾ç½®
  #fake-ip-filter:                    # fakeip è¿‡æ»¤ï¼Œä»¥ä¸‹åœ°å€ä¸ä¼šä¸‹å‘ fakeip æ˜ å°„ç”¨äºè¿æ¥
  #  - '*.lan'
  #  - '*.local'
  #  - 'Mijia Cloud'

  default-nameserver:
    - 223.5.5.5
    - 223.6.6.6
    - 119.29.29.29
    - 114.114.114.114

  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query

  proxy-server-nameserver:
    - 223.5.5.5
    - 223.6.6.6
    - 119.29.29.29
    - 114.114.114.114

  fallback:
    - tls://dns.google
    - tls://one.one.one.one
    - tls://dns.quad9.net

  # ä¸»è¦ç”¨äºè§£å†³DNSæ±¡æŸ“å’Œå®ç°å›½å†…å¤–DNSæœåŠ¡å™¨åˆ†æµ
  fallback-filter:
    geoip: true                   # æ˜¯å¦å¯ç”¨ geoip åˆ¤æ–­
    geoip-code: CN                # geoip-code é…ç½®çš„å›½å®¶çš„ç»“æœä¼šç›´æ¥é‡‡ç”¨ï¼Œå¦åˆ™å°†é‡‡ç”¨ fallbackç»“æœ
    geosite:                      # geosite åˆ—è¡¨çš„å†…å®¹è¢«è§†ä¸ºå·²æ±¡æŸ“ï¼ŒåŒ¹é…åˆ° geosite çš„åŸŸåï¼Œå°†åªä½¿ç”¨ fallbackè§£æ
      - gfw
    ipcidr:                       # è¿™äº›ç½‘æ®µçš„ç»“æœä¼šè¢«è§†ä¸ºæ±¡æŸ“ï¼Œnameserverè§£æå‡ºè¿™äº›ç»“æœæ—¶å°†ä¼šé‡‡ç”¨ fallbackçš„è§£æç»“æœ
      - 240.0.0.0/4
    domain:                      # è¿™äº›åŸŸåè¢«è§†ä¸ºå·²æ±¡æŸ“ï¼ŒåŒ¹é…åˆ°è¿™äº›åŸŸåï¼Œä¼šç›´æ¥ä½¿ç”¨ fallbackè§£æ
      - 'google.com'
      - 'youtube.com'
      - 'facebook.com'
      - 'twitter.com'
      - 'instagram.com'
      - 'telegram.org'
      - 'ytimg.com'

# --- å‡ºç«™ç­–ç•¥ç»„ ---
# é”šç‚¹å®šä¹‰ (å¤ç”¨ç­–ç•¥é€‰é¡¹)
pr: &pr
  type: select
  proxies: [
    ğŸš€ èŠ‚ç‚¹é€‰æ‹©,ğŸ‡ºğŸ‡¸ ç¾å›½, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡°ğŸ‡· éŸ©å›½, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡¹ğŸ‡¼ å°æ¹¾, å…¶ä»–åœ°åŒº,
    âš¡ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ğŸ¯ ç›´è¿
  ]

proxy-groups:
  # --- ä¸»è¦é€‰æ‹©å™¨ ---
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies: [
      ğŸ‡ºğŸ‡¸ ç¾å›½, ğŸ‡¯ğŸ‡µ æ—¥æœ¬, ğŸ‡°ğŸ‡· éŸ©å›½, ğŸ‡­ğŸ‡° é¦™æ¸¯, ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡, ğŸ‡¹ğŸ‡¼ å°æ¹¾, å…¶ä»–åœ°åŒº,
      âš¡ï¸ è‡ªåŠ¨é€‰æ‹©, ğŸŒ å…¨éƒ¨èŠ‚ç‚¹, ğŸ¯ ç›´è¿
    ]

  # --- æŒ‰æœåŠ¡/åº”ç”¨åˆ†æµ (å¼•ç”¨é”šç‚¹) ---
  - {name: ğŸ“· YouTube, <<: *pr}
  - {name: âœˆï¸  Telegram, <<: *pr}
  - {name: ğŸ¤– OpenAI, <<: *pr}
  - {name: ğŸ³ Docker, <<: *pr}
  - {name: ğŸ“’ GitHub, <<: *pr}
  - {name: ğŸ” Google, <<: *pr}
  - {name: â“‚ï¸  Microsoft, <<: *pr}
  - {name: ğŸµ TikTok, <<: *pr}
  - {name: ğŸ§ Spotify, <<: *pr}
  - {name: ğŸ¥ NETFLIX, <<: *pr}
  - {name: ğŸ“º Bilibili, <<: *pr}
  - {name: ğŸ® Steam, <<: *pr}
  - {name: ğŸ Apple, <<: *pr}
  - {name: ğŸ›¡ï¸  Cloudflare, <<: *pr}
  - {name: ğŸ”— Tailscale, <<: *pr}

  # --- ç‰¹æ®Šç­–ç•¥ ---
  - {name: ğŸ¯ å›½å†…æµé‡, <<: *pr}
  - {name: ğŸŸ æ¼ç½‘ä¹‹é±¼, <<: *pr}

  # --- æŒ‰åœ°åŒºæµ‹é€Ÿ ---
  - name: ğŸ‡ºğŸ‡¸ ç¾å›½
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)ç¾å›½|ç¾|US|United States|åœ£ä½•å¡|åœ£è·è¥¿|SJC|San Jose|æ—§é‡‘å±±|å‡¤å‡°åŸ"
  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)æ—¥æœ¬|æ—¥|JP|Japan"
  - name: ğŸ‡°ğŸ‡· éŸ©å›½
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)éŸ©å›½|éŸ©|KR|Korea"
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)é¦™æ¸¯|æ¸¯|HK|Hong Kong"
  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)æ–°åŠ å¡|æ–°|SG|Singapore"
  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾
    #type: select
    include-all: true
    #type: url-test
    tolerance: 50
    type: load-balance
    strategy: round-robin
    #strategy: consistent-hashing
    #strategy: sticky-sessions
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    filter: "(?i)å°æ¹¾|å°ç£|å°|TW|Taiwan"
  - name: å…¶ä»–åœ°åŒº
    #type: select
    include-all: true
    type: url-test
    #use: [A, B, C]
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    exclude-filter: "(?i)(ç›´è¿|é¦™æ¸¯|hongkong|hk|å°æ¹¾|taiwan|tw|æ—¥æœ¬|japan|jp|ç¾å›½|çº½çº¦|å‡¤å‡°åŸ|æ‹‰æ–¯ç»´åŠ æ–¯|åœ£ä½•å¡|united states|usa|us|æ–°åŠ å¡|singapore|sg|éŸ©å›½|korea|kr)"
  # --- å…¨å±€è‡ªåŠ¨æµ‹é€Ÿ / æ‰‹åŠ¨é€‰æ‹© ---
  - name: âš¡ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    #use: [A, B]
    proxies:
      - "ğŸ‡ºğŸ‡¸ ç¾å›½"
      - "ğŸ‡¯ğŸ‡µ æ—¥æœ¬"
      - "ğŸ‡°ğŸ‡· éŸ©å›½"
      - "ğŸ‡­ğŸ‡° é¦™æ¸¯"
      - "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡"
      - "ğŸ‡¹ğŸ‡¼ å°æ¹¾"
      - "å…¶ä»–åœ°åŒº"
    url: "https://www.gstatic.com/generate_204"
    interval: 600
    #timeout: 2000
    #max-failed-times: 3
    tolerance: 50
  - name: ğŸŒ å…¨éƒ¨èŠ‚ç‚¹
    type: select
    include-all: true
    filter: "^((?!(ç›´è¿)).)*$"
# --- è§„åˆ™åŒ¹é… ---
# 1. å¼ºåˆ¶ç›´è¿/ç»•è¿‡çš„ IP æ®µ
# 2. ç‰¹å®šæœåŠ¡çš„åŸŸåè§„åˆ™
# 3. åœ°ç†ä½ç½®åŸŸåè§„åˆ™
# 4. GEOIP åœ°ç†ä½ç½® IP è§„åˆ™
# 5. ç‰¹å®šæœåŠ¡çš„ IP è§„åˆ™
# 6. æœ€ç»ˆ MATCH è§„åˆ™
rules:
  # --- å¼ºåˆ¶ç›´è¿/ç»•è¿‡ (IP) ---
  #- IP-CIDR,192.168.0.0/16,ğŸ¯ ç›´è¿,no-resolve
  - RULE-SET,private_ip,ğŸ¯ ç›´è¿,no-resolve
  - RULE-SET,private_domain,ğŸ¯ ç›´è¿

  # --- æŒ‰åŸŸååˆ†æµ ---
  - RULE-SET,ai_domain,ğŸ¤– OpenAI
  - RULE-SET,steam_domain,ğŸ® Steam
  - RULE-SET,apple_domain,ğŸ Apple
  - RULE-SET,docker_domain,ğŸ³ Docker
  - RULE-SET,github_domain,ğŸ“’ GitHub
  - RULE-SET,tiktok_domain,ğŸµ TikTok
  - RULE-SET,spotify_domain,ğŸ§ Spotify
  - RULE-SET,netflix_domain,ğŸ¥ NETFLIX
  - RULE-SET,youtube_domain,ğŸ“· YouTube
  - RULE-SET,telegram_domain,âœˆï¸  Telegram
  - RULE-SET,bilibili_domain,ğŸ“º Bilibili
  - RULE-SET,microsoft_domain,â“‚ï¸  Microsoft
  - RULE-SET,cloudflare_domain,ğŸ›¡ï¸  Cloudflare
  - RULE-SET,tailscale_domain,ğŸ”— Tailscale
  - RULE-SET,google_domain,ğŸ” Google
  - RULE-SET,cn_domain,ğŸ¯ å›½å†…æµé‡
  - RULE-SET,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # --- æŒ‰IPåˆ†æµ  ---
  - RULE-SET,netflix_ip,ğŸ¥ NETFLIX,no-resolve
  - RULE-SET,telegram_ip,âœˆï¸  Telegram,no-resolve
  - RULE-SET,cloudflare_ip,ğŸ›¡ï¸  Cloudflare,no-resolve
  - RULE-SET,google_ip,ğŸ” Google,no-resolve
  - RULE-SET,cn_ip,ğŸ¯ å›½å†…æµé‡,no-resolve

  # --- æœ€ç»ˆåŒ¹é… ---
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# --- è§„åˆ™é›†å®šä¹‰ ---
rule-anchor:
  ip: &ip {type: http, interval: 86400, behavior: ipcidr, format: mrs}
  domain: &domain {type: http, interval: 86400, behavior: domain, format: mrs}

rule-providers:
  # åŸŸåè§„åˆ™
  private_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/private.mrs"}
  cn_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"}
  docker_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/docker.mrs"}
  apple_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/apple.mrs"}
  cloudflare_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cloudflare.mrs"}
  tailscale_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tailscale.mrs"}
  google_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/google.mrs"}
  ai_domain: { <<: *domain, url: "https://raw.github.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/category-ai-!cn.mrs"}
  github_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/github.mrs"}
  youtube_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/youtube.mrs"}
  microsoft_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.mrs"}
  tiktok_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/tiktok.mrs"}
  telegram_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/telegram.mrs"}
  netflix_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/netflix.mrs"}
  spotify_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/spotify.mrs"}
  bilibili_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/bilibili.mrs"}
  steam_domain: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/steam.mrs"}
  geolocation-!cn: { <<: *domain, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"}

  # IPè§„åˆ™
  private_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/private.mrs"}
  cn_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"}
  google_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/google.mrs"}
  telegram_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/telegram.mrs"}
  netflix_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/netflix.mrs"}
  cloudflare_ip: { <<: *ip, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cloudflare.mrs"}